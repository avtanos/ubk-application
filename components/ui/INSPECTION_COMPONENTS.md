# Компоненты системы выездных проверок

## Обзор

Данные компоненты реализуют полный функционал системы выездных проверок согласно BPMN-процессу и форме акта выездной проверки условий проживания семьи.

## Компоненты

### 1. InspectionReportForm
**Файл:** `components/ui/InspectionReportForm.tsx`

Полная форма акта выездной проверки с 9 разделами:
- Общие сведения
- Данные о заявителе  
- Состав семьи (фактически проживающих)
- Жилищные условия
- Доходы и источники средств
- Земельные участки и имущество
- Выводы специалиста
- Подписи
- Приложения

**Особенности:**
- Пошаговое заполнение с навигацией
- Валидация полей
- Динамическое добавление членов семьи
- Поддержка всех типов полей из формы акта

### 2. ScheduleInspectionForm
**Файл:** `components/ui/ScheduleInspectionForm.tsx`

Форма планирования выездной проверки:
- Выбор типа и приоритета проверки
- Планирование даты и времени
- Назначение инспектора
- Чек-лист подготовки
- Дополнительные заметки

**Особенности:**
- Автоматическое заполнение данных заявителя
- Валидация времени и даты
- Чек-лист подготовки к проверке

### 3. InspectionChecklist
**Файл:** `components/ui/InspectionChecklist.tsx`

Интерактивный чек-лист проверки с тремя категориями:
- **Подготовка** (8 пунктов)
- **Визит** (10 пунктов)  
- **Документирование** (6 пунктов)

**Особенности:**
- Прогресс-бар по категориям
- Заметки к каждому пункту
- Обязательные и необязательные пункты
- Статистика выполнения

### 4. InspectionDetailsModal
**Файл:** `components/ui/InspectionDetailsModal.tsx`

Модальное окно с детальной информацией о проверке:
- **Вкладка "Детали"** - основная информация
- **Вкладка "Чек-лист"** - интерактивный чек-лист
- **Вкладка "Акт проверки"** - просмотр созданного акта

**Особенности:**
- Управление статусами проверки
- Интеграция с чек-листом
- Действия в зависимости от статуса

## Типы данных

### Inspection
Основной тип для выездной проверки:
```typescript
interface Inspection {
  id: number;
  applicationId: number;
  inspectionNumber: string;
  status: InspectionStatus;
  type: InspectionType;
  priority: Priority;
  // ... другие поля
}
```

### InspectionReport
Тип для акта выездной проверки:
```typescript
interface InspectionReport {
  id: number;
  inspectionId: number;
  // ... все поля акта проверки
}
```

### InspectionStatus
Статусы проверки согласно BPMN-процессу:
- `ASSIGNED` - Назначена
- `PREPARATION` - Подготовка
- `IN_PROGRESS` - В процессе
- `COMPLETED` - Завершена
- `CANCELLED` - Отменена
- `REPEAT` - Повторная

## API Сервис

### InspectionService
**Файл:** `lib/api/inspectionService.ts`

Полный набор методов для работы с проверками:
- `createInspection()` - создание проверки
- `getInspections()` - получение списка проверок
- `updateInspectionStatus()` - обновление статуса
- `createInspectionReport()` - создание акта проверки
- `uploadInspectionPhotos()` - загрузка фотографий
- `getInspectionStats()` - статистика проверок

## Интеграция

### Страница выездных проверок
**Файл:** `app/dashboard/inspections/page.tsx`

Обновленная страница с:
- Динамической загрузкой данных
- Интеграцией всех компонентов
- Управлением статусами
- Модальными окнами

### Страница специалиста
**Файл:** `app/specialist/page.tsx`

Добавлен функционал:
- Кнопка "Назначить проверку" для заявок с высоким риском
- Модальное окно планирования проверки
- Автоматическое заполнение данных заявителя

## База данных

### Миграция
**Файл:** `database/migrations/002_create_inspection_tables.sql`

Созданы таблицы:
- `inspection` - выездные проверки
- `inspection_report` - акты проверок
- `inspection_family_member` - члены семьи для акта
- `inspection_photo` - фотографии проверок

### Индексы и ограничения
- Индексы для производительности
- Ограничения целостности данных
- Комментарии к таблицам и полям

## Использование

### Создание проверки
```typescript
const inspectionData = {
  applicationId: 123,
  type: 'PRIMARY',
  priority: 'HIGH',
  scheduledDate: '2024-01-20',
  scheduledTime: '10:00',
  inspectorId: 1,
  inspectorName: 'Иван Иванов',
  address: 'ул. Примерная, 123'
};

await inspectionService.createInspection(inspectionData);
```

### Создание акта проверки
```typescript
const reportData = {
  inspectionId: 456,
  applicationId: 123,
  // ... все поля акта
};

await inspectionService.createInspectionReport(reportData);
```

## Статусы заявлений

Добавлены новые статусы для поддержки проверок:
- `INSPECTION_ASSIGNED` - Назначена выездная проверка
- `INSPECTION_IN_PROGRESS` - Выездная проверка в процессе  
- `INSPECTION_COMPLETED` - Выездная проверка завершена

## Особенности реализации

1. **Полное соответствие форме акта** - все поля и разделы из предоставленной формы
2. **BPMN-процесс** - реализованы все этапы процесса проверки
3. **Типизация** - полная типизация TypeScript
4. **Валидация** - валидация всех полей форм
5. **UX** - интуитивный интерфейс с пошаговым заполнением
6. **Интеграция** - тесная интеграция с существующей системой
